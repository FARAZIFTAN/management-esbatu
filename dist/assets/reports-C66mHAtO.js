import{f as c,j as e}from"./dashboard-DBHlxSUI.js";import{r as y}from"./chart-vendor-BsP-YlrR.js";import{u as F}from"./forms-C6uYz7wI.js";import{u as g,w as A,E as _}from"./export-vendor-K2nD4sDW.js";import{i as $,L as E,j as P,k as R}from"./ui-vendor-CLOm81rz.js";import"./react-vendor-Dazix4UH.js";const C=l=>{try{const t=g.book_new(),s=[["Laporan Manajemen Es Batu Pua Ranga"],["Periode:",l.period],["Tanggal Export:",new Date().toLocaleDateString("id-ID")],[],["RINGKASAN KEUANGAN"],["Total Pemasukan:",c(l.summary.totalIncome)],["Total Pengeluaran:",c(l.summary.totalExpenses)],["Laba/Rugi:",c(l.summary.profit)],[],["DETAIL TRANSAKSI"],["Jumlah Penjualan:",`${l.sales.length} transaksi`],["Jumlah Pengeluaran:",`${l.expenses.length} transaksi`]],a=g.aoa_to_sheet(s);if(g.book_append_sheet(t,a,"Ringkasan"),l.sales.length>0){const m=[["RIWAYAT PENJUALAN"],["Tanggal","Jumlah Es Batu","Total Harga"],...l.sales.map(x=>[new Date(x.date).toLocaleDateString("id-ID"),x.quantity,x.totalPrice])],i=g.aoa_to_sheet(m);g.book_append_sheet(t,i,"Penjualan")}if(l.expenses.length>0){const m=[["RIWAYAT PENGELUARAN"],["Tanggal","Nama Pengeluaran","Jumlah"],...l.expenses.map(x=>[new Date(x.date).toLocaleDateString("id-ID"),x.name,x.amount])],i=g.aoa_to_sheet(m);g.book_append_sheet(t,i,"Pengeluaran")}const d=`Laporan_Es_Batu_${l.period.replace(/\//g,"-")}_${new Date().toISOString().split("T")[0]}.xlsx`;return A(t,d),{success:!0,fileName:d}}catch(t){return console.error("Error exporting to Excel:",t),{success:!1,error:"Gagal mengexport ke Excel"}}},G=async l=>{try{const t=new _("p","mm","a4"),s=20;let a=s;t.setFontSize(18),t.setFont("helvetica","bold"),t.text("Laporan Manajemen Es Batu Pua Ranga",s,a),a+=15,t.setFontSize(12),t.setFont("helvetica","normal"),t.text(`Periode: ${l.period}`,s,a),a+=8,t.text(`Tanggal Export: ${new Date().toLocaleDateString("id-ID")}`,s,a),a+=15,t.setFontSize(14),t.setFont("helvetica","bold"),t.text("RINGKASAN KEUANGAN",s,a),a+=10,t.setFontSize(11),t.setFont("helvetica","normal"),t.text(`Total Pemasukan: ${c(l.summary.totalIncome)}`,s,a),a+=8,t.text(`Total Pengeluaran: ${c(l.summary.totalExpenses)}`,s,a),a+=8;const d=l.summary.profit>=0?[0,128,0]:[255,0,0];t.setTextColor(d[0],d[1],d[2]),t.setFont("helvetica","bold"),t.text(`Laba/Rugi: ${c(l.summary.profit)}`,s,a),t.setTextColor(0,0,0),a+=15,l.sales.length>0&&(t.setFontSize(12),t.setFont("helvetica","bold"),t.text("RIWAYAT PENJUALAN",s,a),a+=10,t.setFontSize(10),t.setFont("helvetica","bold"),t.text("Tanggal",s,a),t.text("Qty",s+40,a),t.text("Total Harga",s+70,a),a+=8,t.setFont("helvetica","normal"),l.sales.slice(0,15).forEach(i=>{a>250&&(t.addPage(),a=s),t.text(new Date(i.date).toLocaleDateString("id-ID"),s,a),t.text(i.quantity.toString(),s+40,a),t.text(c(i.totalPrice),s+70,a),a+=6}),l.sales.length>15&&(t.setFont("helvetica","italic"),t.text(`... dan ${l.sales.length-15} transaksi lainnya`,s,a),a+=10));const m=`Laporan_Es_Batu_${l.period.replace(/\//g,"-")}_${new Date().toISOString().split("T")[0]}.pdf`;return t.save(m),{success:!0,fileName:m}}catch(t){return console.error("Error exporting to PDF:",t),{success:!1,error:"Gagal mengexport ke PDF"}}},Y=({sales:l,expenses:t})=>{const[s,a]=y.useState("month"),[d,m]=y.useState(new Date().toISOString().split("T")[0]),[i,x]=y.useState(new Date().toISOString().slice(0,7)),[f,T]=y.useState(new Date().getFullYear().toString()),[b,N]=y.useState(!1),{showSuccess:k,showError:v,showLoading:L,dismiss:w}=F(),o=y.useMemo(()=>{let r=[],p=[];switch(s){case"day":r=l.filter(n=>n.date&&n.date===d),p=t.filter(n=>n.date&&n.date===d);break;case"month":r=l.filter(n=>n.date&&n.date.startsWith(i)),p=t.filter(n=>n.date&&n.date.startsWith(i));break;case"year":r=l.filter(n=>n.date&&n.date.startsWith(f)),p=t.filter(n=>n.date&&n.date.startsWith(f));break}const h=r.reduce((n,j)=>n+(j.totalPrice||0),0),u=p.reduce((n,j)=>n+(j.amount||0),0),I=h-u;return{filteredSales:r,filteredExpenses:p,totalIncome:h,totalExpenses:u,profit:I}},[l,t,s,d,i,f]),S=async r=>{if(b)return;N(!0);const p=L(`Mengexport laporan ${r.toUpperCase()}...`);try{const h={period:s==="day"?d:s==="month"?i:f,type:s,summary:{totalIncome:o.totalIncome,totalExpenses:o.totalExpenses,profit:o.profit},sales:o.filteredSales,expenses:o.filteredExpenses};let u;r==="excel"?u=C(h):u=await G(h),w(p),u.success?k(`Laporan ${r.toUpperCase()} berhasil di-download: ${u.fileName}`):v(u.error||"Gagal mengexport laporan")}catch(h){w(p),v("Terjadi kesalahan saat mengexport laporan"),console.error("Export error:",h)}finally{N(!1)}},D=()=>{switch(s){case"day":return new Date(d).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"});case"month":return new Date(i+"-01").toLocaleDateString("id-ID",{month:"long",year:"numeric"});case"year":return f;default:return""}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Laporan"}),e.jsx("p",{className:"text-gray-600",children:"Analisis keuangan usaha es batu"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx($,{className:"h-5 w-5 text-purple-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Filter Laporan"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Jenis Filter"}),e.jsxs("select",{value:s,onChange:r=>a(r.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[e.jsx("option",{value:"day",children:"Harian"}),e.jsx("option",{value:"month",children:"Bulanan"}),e.jsx("option",{value:"year",children:"Tahunan"})]})]}),s==="day"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pilih Tanggal"}),e.jsx("input",{type:"date",value:d,onChange:r=>m(r.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),s==="month"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pilih Bulan"}),e.jsx("input",{type:"month",value:i,onChange:r=>x(r.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),s==="year"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pilih Tahun"}),e.jsx("input",{type:"number",value:f,onChange:r=>T(r.target.value),min:"2020",max:"2030",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),e.jsxs("div",{className:"flex items-end space-x-2",children:[e.jsxs("button",{onClick:()=>S("excel"),disabled:b,className:"flex-1 bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center space-x-1 disabled:opacity-50 disabled:cursor-not-allowed",children:[b?e.jsx(E,{className:"h-4 w-4 animate-spin"}):e.jsx(P,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:"Excel"})]}),e.jsxs("button",{onClick:()=>S("pdf"),disabled:b,className:"flex-1 bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition-colors flex items-center justify-center space-x-1 disabled:opacity-50 disabled:cursor-not-allowed",children:[b?e.jsx(E,{className:"h-4 w-4 animate-spin"}):e.jsx(P,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:"PDF"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-emerald-50 p-6 rounded-xl border border-emerald-200",children:[e.jsx("h3",{className:"text-sm font-medium text-emerald-700 mb-2",children:"Pemasukan"}),e.jsx("p",{className:"text-2xl font-bold text-emerald-800",children:c(o.totalIncome)}),e.jsxs("p",{className:"text-sm text-emerald-600 mt-1",children:[o.filteredSales.length," transaksi"]})]}),e.jsxs("div",{className:"bg-red-50 p-6 rounded-xl border border-red-200",children:[e.jsx("h3",{className:"text-sm font-medium text-red-700 mb-2",children:"Pengeluaran"}),e.jsx("p",{className:"text-2xl font-bold text-red-800",children:c(o.totalExpenses)}),e.jsxs("p",{className:"text-sm text-red-600 mt-1",children:[o.filteredExpenses.length," transaksi"]})]}),e.jsxs("div",{className:`p-6 rounded-xl border ${o.profit>=0?"bg-blue-50 border-blue-200":"bg-red-50 border-red-200"}`,children:[e.jsx("h3",{className:`text-sm font-medium mb-2 ${o.profit>=0?"text-blue-700":"text-red-700"}`,children:"Laba/Rugi"}),e.jsx("p",{className:`text-2xl font-bold ${o.profit>=0?"text-blue-800":"text-red-800"}`,children:c(o.profit)}),e.jsxs("p",{className:`text-sm mt-1 ${o.profit>=0?"text-blue-600":"text-red-600"}`,children:["Periode: ",D()]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",id:"report-content",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Laporan Detail"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Periode: ",D()]})]}),e.jsx(R,{className:"h-6 w-6 text-gray-400"})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Riwayat Penjualan"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Tanggal"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Qty"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Total"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:o.filteredSales.length>0?o.filteredSales.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2",children:r.date?new Date(r.date).toLocaleDateString("id-ID"):"-"}),e.jsx("td",{className:"px-3 py-2",children:r.quantity||0}),e.jsx("td",{className:"px-3 py-2 font-medium",children:c(r.totalPrice||0)})]},r.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"px-3 py-4 text-center text-gray-500",children:"Tidak ada data penjualan"})})})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Riwayat Pengeluaran"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Tanggal"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Nama"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Jumlah"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:o.filteredExpenses.length>0?o.filteredExpenses.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2",children:r.date?new Date(r.date).toLocaleDateString("id-ID"):"-"}),e.jsx("td",{className:"px-3 py-2",children:r.name||"Pengeluaran"}),e.jsx("td",{className:"px-3 py-2 font-medium",children:c(r.amount||0)})]},r.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"px-3 py-4 text-center text-gray-500",children:"Tidak ada data pengeluaran"})})})]})})]})]})})]})]})};export{Y as default};
